<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>main3</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="./js/d3.min.js"></script>
    <link href="./stylesheets/main2.css" rel="stylesheet" />
    <style>
    .axis line {
        fill: none;
        stroke: #ddd;
        shape-rendering: crispEdges;
        vector-effect: non-scaling-stroke;
    }
    
    .dot circle {
        fill: lightsteelblue;
        stroke: steelblue;
        stroke-width: 1.5px;
    }
    
    .dot circle.dragging {
        fill: red;
        stroke: brown;
    }
    </style>
</head>

<body>
    <div id="DivSvg"></div>
</body>

</html>
<script>
$(function() {
    var create_draw = function() {

        var _domName;
        var _width;
        var _height;
        var _left;
        var _right;
        var _top;
        var _bottom;

        var _zoom;
        var _svg;
        var _rect;
        var _container;

        var _yAxisGrid; // 背景格線
        var _xAxisGrid;

        var _drag;

        var zoomed = function() {
            _container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }

        var CreateBasicFrame = function() {

            _zoom = d3.behavior.zoom()
                .scaleExtent([1, 10])
                .on("zoom", zoomed);

            _svg = d3.select(_domName).append("svg")
                .attr({
                    'class': 'bodysvg',
                    "width": _width + _left + _right,
                    "height": _height + _top + _bottom,
                    "transform": "translate(" + _left + "," + _right + ")"
                })
                .append("g")
                .call(_zoom);



            _rect = _svg.append("rect")
                .attr("width", _width)
                .attr("height", _height)
                .style("fill", "none")
                .style("pointer-events", "all");

            _container = _svg.append("g");

            _drag = d3.behavior.drag()
                .on('dragstart', function(d) {
                    d3.event.sourceEvent.stopPropagation();
                    d3.select(this).classed("dragging", true);
                })
                .on('drag', function(d) {
                    d.x += d3.event.dx;
                    d.y += d3.event.dy;
                    d3.select(this).attr("transform", function(d, i) {
                        return "translate(" + [d.x, d.y] + "),rotate(" + d.r + ",160, 160),scale(" + d.scale + "," + d.scale + ")";
                    });
                })
                .on('dragend', function(d) {
                    d3.select(this).classed("dragging", false);
                });
        };

        var CreateGridLine = function() {
            _container.append("g")
                .attr("class", "x axis")
                .selectAll("line")
                .data(d3.range(0, _width, 50))
                .enter().append("line")
                .attr("x1", function(d) {
                    return d;
                })
                .attr("y1", 0)
                .attr("x2", function(d) {
                    return d;
                })
                .attr("y2", _height);

            _container.append("g")
                .attr("class", "y axis")
                .selectAll("line")
                .data(d3.range(0, _height, 50))
                .enter().append("line")
                .attr("x1", 0)
                .attr("y1", function(d) {
                    return d;
                })
                .attr("x2", _width)
                .attr("y2", function(d) {
                    return d;
                });
        };

        var CreateObject = function() {

            var dgrop = _container.append("g")
                .data([{
                    "x": 20,
                    "y": 20,
                    "r": 1,
                    "scale": 1
                }])
                .attr("x", 0)
                .attr("y", 0)
                .attr("transform", "translate(0,0)")
                .append('image')
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", 300)
                .attr("height", 300)
                .attr("xlink:href", "./img/car.svg")
                .call(_drag);

            // var parentg = _container.append('g').attr({
            //     'id': 'img1',
            // }).on("zoom", _zoom);

            // var osvg = parentg.append('svg').attr({
            //     'class': 'svg-img',
            //     'position': 'absolute',
            //     'z-index': 100
            // });

            // var ogFrame = osvg.append('g').attr({
            //     'class': 'g-frame',
            //     'transform': 'translate(150,150)'
            // });

            // var ogImg = osvg.append('g').attr({
            //     'class': 'g-img',
            //     'transform': 'translate(150,150)'
            // });

            // parentg.selectAll('image')
            //     .data([{
            //         "x": 0,
            //         "y": 0
            //     }])
            //     .enter()
            //     .append('image')
            //     .attr({
            //         'xlink:href': './img/car.svg',
            //         'width': 100,
            //         'height': 100,
            //         // 'cx': function(d) {
            //         //     return d.cx;
            //         // },
            //         // 'cy': function(d) {
            //         //     return d.cy;
            //         // }
            //     });
            //     // .call(_drag);


            // _container.append("g")
            //     .attr("class", "dot")
            //     .selectAll("circle")
            //     .data([{
            //         'cx': 210,
            //         'cy': 210,
            //     }])
            //     .enter().append("circle")
            //     .attr("r", 50)
            //     .attr({
            //         'cx': function(d) {
            //             return d.cx;
            //         },
            //         'cy': function(d) {
            //             return d.cy;
            //         }
            //     })
            //     .call(_drag);
        };

        return {
            init: function($RuleData) {
                // console.log($RuleData);
                _domName = $RuleData.dom;
                _width = $RuleData.width;
                _height = $RuleData.height;
                _left = $RuleData.left;
                _right = $RuleData.right;
                _top = $RuleData.top;
                _bottom = $RuleData.bottom;

                CreateBasicFrame();
                CreateGridLine();
                CreateObject();
            }
        }
    }();


    var $RuleData = {
        height: $('body')[0].clientHeight,
        width: $('body')[0].clientWidth,
        top: -5,
        right: -5,
        bottom: -5,
        left: -5,
        dom: '#DivSvg',
    };

    create_draw.init($RuleData);

});
</script>
